<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Choose Sports & Skills</title>
  <link rel="stylesheet" href="/static/subjectsdesign.css"> <!-- ✅ reuse same CSS -->
</head>
<body>
  <main class="container" role="main">
    <header>
      <div>
        <h1>Choose your Sports & Skills</h1>
        <p class="lead">Pick the sports and skills that represent you best.</p>
      </div>
      <div class="note">You can pick one or many</div>
    </header>

    <form id="sportsSkillsForm" autocomplete="on">
      <div class="grid" id="sportsSkillsGrid">
        <!-- Sports -->
        <div class="subject"><input type="checkbox" name="choices" id="c-basketball" value="Basketball"><label for="c-basketball">Basketball</label></div>
        <div class="subject"><input type="checkbox" name="choices" id="c-football" value="Football"><label for="c-football">Football</label></div>
        <div class="subject"><input type="checkbox" name="choices" id="c-volleyball" value="Volleyball"><label for="c-volleyball">Volleyball</label></div>
        <div class="subject"><input type="checkbox" name="choices" id="c-swimming" value="Swimming"><label for="c-swimming">Swimming</label></div>
        <div class="subject"><input type="checkbox" name="choices" id="c-tennis" value="Tennis"><label for="c-tennis">Tennis</label></div>
        <div class="subject"><input type="checkbox" name="choices" id="c-running" value="Running"><label for="c-running">Running</label></div>

        <!-- Skills -->
        <div class="subject"><input type="checkbox" name="choices" id="c-leadership" value="Leadership"><label for="c-leadership">Leadership</label></div>
        <div class="subject"><input type="checkbox" name="choices" id="c-teamwork" value="Teamwork"><label for="c-teamwork">Teamwork</label></div>
        <div class="subject"><input type="checkbox" name="choices" id="c-coding" value="Coding"><label for="c-coding">Coding</label></div>
        <div class="subject"><input type="checkbox" name="choices" id="c-communication" value="Communication"><label for="c-communication">Communication</label></div>

        <!-- ✅ Others input -->
        <div class="subject other-input">
          <label for="c-other">Others:</label>
          <input type="text" id="c-other" name="otherChoice" placeholder="Type here..." />
        </div>
      </div>

      <div class="controls">
        <button type="button" id="selectAll" class="btn ghost">Select all</button>
        <button type="button" id="clearAll" class="btn ghost">Clear</button>
        <button type="submit" class="btn">next</button>
        <div class="note" id="countNote">0 selected</div>
      </div>

      <div class="error" id="errorMsg">Please select at least one choice.</div>

      <div class="confirm" id="confirmPanel" aria-live="polite">
        <h3>Selected choices</h3>
        <div class="tags" id="selectedTags"></div>
        <div style="margin-top:12px; display:flex; gap:10px;">
          <button type="button" id="continueBtn" class="btn">Continue</button>
          <button type="button" id="editBtn" class="btn ghost">Edit selection</button>
        </div>
      </div>
    </form>
  </main>

  <script>
    // DOM refs
    const form = document.getElementById('sportsSkillsForm');
    const checkboxes = Array.from(document.querySelectorAll("input[name='choices']"));
    const countNote = document.getElementById('countNote');
    const selectAllBtn = document.getElementById('selectAll');
    const clearAllBtn = document.getElementById('clearAll');
    const errorMsg = document.getElementById('errorMsg');
    const confirmPanel = document.getElementById('confirmPanel');
    const selectedTags = document.getElementById('selectedTags');
    const continueBtn = document.getElementById('continueBtn');
    const editBtn = document.getElementById('editBtn');
    const otherInput = document.getElementById('c-other');

    function updateCount(){
      const n = checkboxes.filter(cb => cb.checked).length;
      countNote.textContent = n + ' selected';
    }

    // toggle when clicking the card
    document.getElementById('sportsSkillsGrid').addEventListener('click', (e) => {
      const target = e.target;
      if(target.tagName === 'DIV' && target.classList.contains('subject') && !target.classList.contains('other-input')){
        const cb = target.querySelector("input[type='checkbox']");
        cb.checked = !cb.checked;
        updateCount();
      }
      if(target.tagName === 'LABEL'){
        setTimeout(updateCount, 5);
      }
    });

    // select all
    selectAllBtn.addEventListener('click', () => {
      checkboxes.forEach(cb => cb.checked = true);
      updateCount();
    });

    // clear all
    clearAllBtn.addEventListener('click', () => {
      checkboxes.forEach(cb => cb.checked = false);
      otherInput.value = "";
      updateCount();
    });

    // live update
    checkboxes.forEach(cb => cb.addEventListener('change', updateCount));
    updateCount();

    // submit
    form.addEventListener('submit', (e) => {
      e.preventDefault();
      const selected = checkboxes.filter(cb => cb.checked).map(cb => cb.value);
      const otherVal = otherInput.value.trim();
      if(otherVal) selected.push(otherVal);

      if(selected.length === 0){
        errorMsg.style.display = 'block';
        confirmPanel.style.display = 'none';
        return;
      }
      errorMsg.style.display = 'none';

      localStorage.setItem('selectedSportsSkills', JSON.stringify(selected));

      selectedTags.innerHTML = '';
      selected.forEach(s => {
        const el = document.createElement('span');
        el.className = 'tag';
        el.textContent = s;
        selectedTags.appendChild(el);
      });
      confirmPanel.style.display = 'block';
      confirmPanel.scrollIntoView({ behavior: 'smooth', block: 'center' });
    });

    continueBtn.addEventListener('click', () => {
      window.location.href = 'subjects.html';
    });

    editBtn.addEventListener('click', () => {
      confirmPanel.style.display = 'none';
    });
  </script>
</body>
</html>
